<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio WebSocket Stream</title>
</head>
<body>
    <h1>Audio Streaming to WebSocket</h1>
    <button id="startButton">Start Streaming</button>
    <button id="stopButton" disabled>Stop Streaming</button>
    <p id="status">Status: Not Connected</p>

    <script>
        let mediaRecorder;
        let ws;

        document.getElementById("startButton").onclick = async function() {
            ws = new WebSocket('ws://localhost:7007'); // Adjust the WebSocket URL as needed

            ws.onopen = async function() {
                console.log('WebSocket connection established');
                document.getElementById("status").innerText = "Status: Connected";

                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/wav' });

                mediaRecorder.ondataavailable = function(event) {
                    if (event.data.size > 0) {
                        ws.send(event.data); // Send audio data as a Blob
                    }
                };

                mediaRecorder.start(1000); // Collect 1-second chunks
                document.getElementById("startButton").disabled = true;
                document.getElementById("stopButton").disabled = false;
            };

            ws.onmessage = function(event) {
                console.log('Received message:', event.data);
            };

            ws.onclose = function() {
                console.log('WebSocket connection closed');
                document.getElementById("status").innerText = "Status: Disconnected";
                document.getElementById("startButton").disabled = false;
                document.getElementById("stopButton").disabled = true;
            };
        };

        document.getElementById("stopButton").onclick = function() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
            }
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.close();
            }
        };
    </script>
</body>
</html>
